<%
  value ||= 0
  max ||= 100
  size ||= :md
  variant ||= :primary
  label ||= false
  label_text ||= nil
  html_options ||= {}
  content ||= nil

  percentage = max > 0 ? ((value.to_f / max) * 100).round : 0

  height = case size.to_sym
  when :sm then "h-1.5"
  when :lg then "h-4"
  when :xl then "h-6"
  else "h-2.5"
  end

  color = case variant.to_sym
  when :success then "bg-green-600 dark:bg-green-500"
  when :danger then "bg-red-600 dark:bg-red-500"
  when :warning then "bg-yellow-400 dark:bg-yellow-300"
  when :indigo then "bg-indigo-600 dark:bg-indigo-500"
  when :purple then "bg-purple-600 dark:bg-purple-500"
  else "bg-blue-600 dark:bg-blue-500"
  end

  show_label = label && (size.to_sym == :lg || size.to_sym == :xl)
  classes = [html_options.delete(:class)].compact_blank.join(" ")
%>

<div class="<%= classes %>" <%= tag.attributes(html_options) %>>
  <% if label_text %>
    <div class="flex justify-between mb-1">
      <span class="text-base font-medium text-gray-700 dark:text-white"><%= label_text %></span>
      <span class="text-sm font-medium text-gray-700 dark:text-white"><%= percentage %>%</span>
    </div>
  <% end %>
  <div class="w-full bg-gray-200 rounded-full dark:bg-gray-700 <%= height %>">
    <div class="<%= color %> <%= height %> rounded-full<%= " flex items-center justify-center" if show_label %>" style="width: <%= percentage %>%">
      <% if show_label %>
        <span class="text-xs font-medium text-white"><%= percentage %>%</span>
      <% end %>
    </div>
  </div>
</div>
