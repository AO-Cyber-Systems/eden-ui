<%
  url ||= "#"
  method ||= :post
  heading ||= "Two-factor authentication"
  description ||= "Enter the code from your authenticator app."
  code_length ||= 6
  resend_url ||= nil
  back_url ||= nil
  submit_text ||= "Verify"
  html_options ||= {}
  content ||= nil

  input_classes = "block h-12 w-12 rounded-lg border border-gray-300 bg-white text-center text-lg font-bold text-gray-900 focus:border-primary-500 focus:ring-primary-500 dark:border-gray-600 dark:bg-gray-700 dark:text-white dark:placeholder-gray-400 dark:focus:border-primary-500 dark:focus:ring-primary-500"
  submit_classes = "w-full rounded-lg bg-primary-600 px-5 py-2.5 text-center text-sm font-medium text-white hover:bg-primary-700 focus:outline-none focus:ring-4 focus:ring-primary-300 dark:bg-primary-600 dark:hover:bg-primary-700 dark:focus:ring-primary-800 cursor-pointer"
  link_classes = "font-medium text-primary-600 hover:underline dark:text-primary-500"

  classes = [
    "space-y-4",
    html_options.delete(:class)
  ].compact_blank.join(" ")
%>

<div class="<%= classes %>" <%= tag.attributes(html_options) %>>
  <h1 class="text-xl font-bold leading-tight tracking-tight text-gray-900 md:text-2xl dark:text-white"><%= heading %></h1>
  <p class="text-sm text-gray-500 dark:text-gray-400"><%= description %></p>

  <form action="<%= url %>" method="<%= method == :get ? "get" : "post" %>">
    <% unless method == :get %>
      <input type="hidden" name="authenticity_token" value="<%= form_authenticity_token %>">
    <% end %>
    <% if method != :post && method != :get %>
      <input type="hidden" name="_method" value="<%= method %>">
    <% end %>

    <%# Hidden field to collect the full code %>
    <input type="hidden" name="otp_code" id="otp_code_full">

    <div class="my-4 flex justify-center gap-2 sm:gap-3" data-controller="otp-input">
      <% code_length.times do |i| %>
        <div>
          <label for="code-<%= i + 1 %>" class="sr-only">Code digit <%= i + 1 %></label>
          <input
            type="text"
            maxlength="1"
            pattern="[0-9]"
            inputmode="numeric"
            id="code-<%= i + 1 %>"
            data-otp-input-target="digit"
            autocomplete="one-time-code"
            class="<%= input_classes %>"
            required
          >
        </div>
      <% end %>
    </div>

    <button type="submit" class="<%= submit_classes %>"><%= submit_text %></button>

    <% if resend_url %>
      <p class="mt-4 text-center text-sm text-gray-500 dark:text-gray-400">
        Didn't receive a code?
        <a href="<%= resend_url %>" class="<%= link_classes %>">Resend code</a>
      </p>
    <% end %>

    <% if back_url %>
      <p class="mt-3 text-center text-sm text-gray-500 dark:text-gray-400">
        <a href="<%= back_url %>" class="<%= link_classes %>">
          <svg class="mr-1 inline h-4 w-4" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M5 12l4-4m-4 4 4 4"/>
          </svg>
          Back to login
        </a>
      </p>
    <% end %>
  </form>

  <%= content %>
</div>
