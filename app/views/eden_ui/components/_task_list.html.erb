<%
  title ||= nil
  tasks ||= []
  html_options ||= {}
  content ||= nil

  classes = [
    "bg-white border border-zinc-200 rounded-lg shadow-sm dark:bg-zinc-800 dark:border-zinc-700",
    html_options.delete(:class)
  ].compact_blank.join(" ")

  # Group tasks by priority if we have tasks with mixed priorities
  priorities_order = { high: 0, medium: 1, low: 2 }
  grouped = tasks.group_by { |t| t[:priority]&.to_sym || :medium }.sort_by { |k, _| priorities_order[k] || 1 }
  has_mixed = grouped.size > 1
%>

<div class="<%= classes %>" <%= tag.attributes(html_options) %>>
  <% if title %>
    <div class="px-4 py-3 border-b border-zinc-200 dark:border-zinc-700">
      <h3 class="text-lg font-semibold text-zinc-900 dark:text-white"><%= title %></h3>
    </div>
  <% end %>

  <div class="p-4 space-y-2">
    <% if content %>
      <%= content %>
    <% elsif tasks.any? %>
      <% if has_mixed %>
        <% grouped.each do |priority, group_tasks| %>
          <%
            priority_label = case priority
            when :high then "High priority"
            when :low then "Low priority"
            else "Medium priority"
            end
          %>
          <h4 class="text-xs font-semibold uppercase tracking-wider text-zinc-500 dark:text-zinc-400 mt-3 first:mt-0 mb-2"><%= priority_label %></h4>
          <% group_tasks.each do |task| %>
            <%= eden_task_item(
              title: task[:title],
              completed: task[:completed] || false,
              priority: task[:priority] || :medium,
              assignee: task[:assignee],
              due_date: task[:due_date]
            ) %>
          <% end %>
        <% end %>
      <% else %>
        <% tasks.each do |task| %>
          <%= eden_task_item(
            title: task[:title],
            completed: task[:completed] || false,
            priority: task[:priority] || :medium,
            assignee: task[:assignee],
            due_date: task[:due_date]
          ) %>
        <% end %>
      <% end %>
    <% else %>
      <%= eden_empty_state(title: "No tasks yet", description: "Create your first task to get started.", icon: "check-circle") %>
    <% end %>
  </div>
</div>
