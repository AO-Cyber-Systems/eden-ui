<%
  title ||= ""
  description ||= nil
  priority ||= nil
  due_date ||= nil
  assignees ||= []
  tags ||= []
  html_options ||= {}
  content ||= nil

  priority_color = case priority&.to_sym
  when :high then "bg-red-500"
  when :medium then "bg-yellow-400"
  when :low then "bg-green-500"
  else nil
  end

  classes = [
    "bg-white dark:bg-zinc-700 p-3 rounded-lg shadow-sm border border-zinc-200 dark:border-zinc-600 cursor-grab hover:shadow-md transition-shadow",
    html_options.delete(:class)
  ].compact_blank.join(" ")
%>

<div class="<%= classes %>" <%= tag.attributes(html_options) %>>
  <%# Title row with priority %>
  <div class="flex items-start gap-2 mb-1">
    <% if priority_color %>
      <span class="mt-1.5 w-2 h-2 rounded-full flex-shrink-0 <%= priority_color %>"></span>
    <% end %>
    <h4 class="text-sm font-medium text-zinc-900 dark:text-white"><%= title %></h4>
  </div>

  <%# Description %>
  <% if description %>
    <p class="text-sm text-zinc-500 dark:text-zinc-400 truncate mb-2"><%= description %></p>
  <% end %>

  <%# Tags %>
  <% if tags.any? %>
    <div class="flex flex-wrap gap-1 mb-2">
      <% tags.each do |t| %>
        <%
          tag_color = case t[:color]&.to_sym
          when :blue then "bg-primary-100 text-primary-800 dark:bg-primary-900 dark:text-primary-300"
          when :green then "bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-300"
          when :red then "bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-300"
          when :yellow then "bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300"
          when :purple then "bg-purple-100 text-purple-800 dark:bg-purple-900 dark:text-purple-300"
          when :pink then "bg-pink-100 text-pink-800 dark:bg-pink-900 dark:text-pink-300"
          else "bg-zinc-100 text-zinc-800 dark:bg-zinc-600 dark:text-zinc-300"
          end
        %>
        <span class="inline-flex items-center px-1.5 py-0.5 text-xs font-medium rounded <%= tag_color %>"><%= t[:label] %></span>
      <% end %>
    </div>
  <% end %>

  <%# Custom block content %>
  <%= content %>

  <%# Footer: assignees + due date %>
  <% if assignees.any? || due_date %>
    <div class="flex items-center justify-between mt-2 pt-2 border-t border-zinc-100 dark:border-zinc-600">
      <% if assignees.any? %>
        <div class="flex -space-x-2">
          <% assignees.each do |assignee| %>
            <%= eden_avatar(src: assignee[:src], initials: assignee[:initials], alt: assignee[:name] || "", size: :xs, rounded: true) %>
          <% end %>
        </div>
      <% else %>
        <div></div>
      <% end %>
      <% if due_date %>
        <span class="flex items-center text-xs text-zinc-500 dark:text-zinc-400">
          <svg class="w-3 h-3 me-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>
          <%= due_date %>
        </span>
      <% end %>
    </div>
  <% end %>
</div>
