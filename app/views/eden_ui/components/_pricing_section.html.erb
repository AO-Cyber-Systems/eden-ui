<%
  title ||= "Pricing"
  subtitle ||= nil
  plans ||= []
  billing_toggle ||= false
  html_options ||= {}
  content ||= nil

  plan_count = [plans.size, 4].min
  col_class = case plan_count
  when 1 then "max-w-lg mx-auto"
  when 2 then "md:grid-cols-2 max-w-screen-md mx-auto"
  when 3 then "md:grid-cols-2 lg:grid-cols-3 max-w-screen-lg mx-auto"
  else "md:grid-cols-2 lg:grid-cols-4"
  end

  classes = ["bg-white dark:bg-zinc-900", html_options.delete(:class)].compact_blank.join(" ")
%>

<section class="<%= classes %>" <%= tag.attributes(html_options) %>>
  <div class="py-8 px-4 mx-auto max-w-screen-xl lg:py-16">
    <div class="mx-auto max-w-screen-md text-center mb-8 lg:mb-12">
      <% if title %>
        <h2 class="mb-4 text-3xl font-extrabold tracking-tight text-zinc-900 dark:text-white md:text-4xl"><%= title %></h2>
      <% end %>
      <% if subtitle %>
        <p class="mb-5 font-light text-zinc-500 dark:text-zinc-400 sm:text-xl"><%= subtitle %></p>
      <% end %>
    </div>

    <% if billing_toggle %>
      <div class="flex justify-center items-center mb-10 space-x-4">
        <span class="text-sm font-medium text-zinc-900 dark:text-white">Monthly</span>
        <label class="relative inline-flex items-center cursor-pointer">
          <input type="checkbox" class="sr-only peer">
          <div class="w-11 h-6 bg-zinc-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-primary-300 dark:peer-focus:ring-primary-800 rounded-full peer dark:bg-zinc-700 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:border-zinc-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all dark:border-zinc-600 peer-checked:bg-primary-600"></div>
        </label>
        <span class="text-sm font-medium text-zinc-900 dark:text-white">Annual <span class="text-xs text-green-500 font-semibold">Save 20%</span></span>
      </div>
    <% end %>

    <div class="grid gap-8 <%= col_class %>">
      <% plans.each do |plan| %>
        <%
          is_popular = plan[:popular]
          card_ring = is_popular ? "ring-2 ring-primary-500 dark:ring-primary-400" : "border border-zinc-200 dark:border-zinc-700"
          plan_features = plan[:features] || []
          plan_period = plan[:period] || "/month"
          plan_cta_text = plan[:cta_text] || "Get started"
          plan_cta_href = plan[:cta_href] || "#"
        %>
        <div class="flex flex-col p-6 bg-white rounded-lg shadow dark:bg-zinc-800 xl:p-8 <%= card_ring %>">
          <% if is_popular %>
            <div class="mb-4">
              <%= eden_badge(text: "Most popular", variant: :primary, pill: true) %>
            </div>
          <% end %>

          <h3 class="mb-2 text-2xl font-semibold text-zinc-900 dark:text-white"><%= plan[:name] %></h3>

          <% if plan[:description] %>
            <p class="font-light text-zinc-500 dark:text-zinc-400 sm:text-lg mb-4"><%= plan[:description] %></p>
          <% end %>

          <div class="flex items-baseline my-8">
            <span class="text-5xl font-extrabold text-zinc-900 dark:text-white"><%= plan[:price] %></span>
            <span class="ms-1 text-xl font-normal text-zinc-500 dark:text-zinc-400"><%= plan_period %></span>
          </div>

          <ul role="list" class="mb-8 space-y-4 text-left flex-1">
            <% plan_features.each do |feature| %>
              <li class="flex items-center space-x-3">
                <svg class="flex-shrink-0 w-5 h-5 text-green-500 dark:text-green-400" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/></svg>
                <span class="text-zinc-500 dark:text-zinc-400"><%= feature %></span>
              </li>
            <% end %>
          </ul>

          <% btn_variant = is_popular ? :primary : :dark %>
          <% btn_outline = !is_popular %>
          <%= eden_button(variant: btn_variant, outline: btn_outline, size: :lg, href: plan_cta_href) { plan_cta_text } %>
        </div>
      <% end %>
    </div>

    <%= content %>
  </div>
</section>
